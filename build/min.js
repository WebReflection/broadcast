/*! (C) Andrea Giammarchi Mit Style License */
var broadcast=function(){function e(t){"use strict";function l(e){return i.call(r,e)?r[e]:r[e]={args:null,cb:[]}}function c(e){var t=arguments.length,n=l(e),r=1,i;if(r===t)return function(){var t=[e];return t.push.apply(t,arguments),c.apply(null,t)};n.args=[];while(r<t)n.args.push(arguments[r++]);r=0,t=n.cb.length,i=n.cb.splice(r,t);while(r<t)a(n.args).then(o.call(s,i[r++]));return n.args[0]}function h(e,t){var r=l(e),i;return arguments.length===1&&(i=new Promise(function(e){t=e})),n&&r.args?a(r.args).then(o.call(s,t)):u.call(r.cb,t)<0&&r.cb.push(t),i}var n=!0,r=(t.create||t)(null),i=t.prototype.hasOwnProperty,s=function(e){this.apply(null,e)},o=t.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}},u=Array.prototype.indexOf||function(t){var n=this.length;while(n--&&this[n]!==t);return n},a=typeof Promise=="undefined"?function(e){return{then:function(t){setTimeout(t,1,e)}}}:function(e){return Promise.resolve(e)},f=typeof WeakMap=="undefined"?function(e,t){return{"delete":function(n){var r=u.call(e,n);e.splice(r,1),t.splice(r,1)},get:function(n){return t[u.call(e,n)]},set:function(n,r){t[e.push(n)-1]=r}}}([],[]):new WeakMap;return(t.freeze||t)({when:h,about:c,that:c,drop:function p(e,t){var n=f.get(t),r,i;n?(f["delete"](t),p(e,n)):(r=l(e).cb,i=u.call(r,t),~i&&r.splice(i,1))},"new":function(){return e(t)},all:function(t,r){f.get(r)||(f.set(r,function i(){n=!1,h(t,i),n=!0,a(arguments).then(o.call(s,r))}),h(t,f.get(r)))}})}return e(Object)}();